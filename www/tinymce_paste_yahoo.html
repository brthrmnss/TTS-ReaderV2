<html>

<head>
    <meta charset="utf-8"/>
    <title>Paste - TinyMCE Reader</title>

    <link rel="stylesheet" type="text/css" href="/js/contextMenu.css">
    <script src="js/lib/jquery-1.11.2.min.js"></script>


    <script src="js/list.js"></script>
    <script src="js/nlp_compromise.js"></script>
    <script src="js/lib/js.cookie.js"></script>

    <script src="js/ui_utils.js"></script>

    <!--    <script src="js/speakHTMLText_Cleaned.js"></script>-->
    <script src="js/speakHTMLText_CleanedV2.js"></script>
    <!--
    <script src="js/speakHTMLText_CleanedV2_Working.js"></script>
    -->
    <script src="js/removeDiacritics.js"></script>

    <!--<script src="js/reloader.js"></script>-->
    <!-- <script src="js/lib/jquery-1.11.2.min.js"></script>
     <script src="js/lib/js.cookie.js"></script>
     <script src="js/speakHTMLText_Cleaned.js"></script>
     <script src="js/contextMenu.js"></script>
     <script src="js/reloader.js"></script>
     <script src="js/dropzone.js"></script>

     <script src="js/list.js"></script>
     <script src="js/nlp_compromise.js"></script>

     <link rel="stylesheet" type="text/css" href="/js/speak.css">
     <link rel="stylesheet" type="text/css" href="css/layouts.css">

     <link rel="stylesheet" type="text/css" href="/js/contextMenu.css">

     <link rel="stylesheet" type="text/css" href="dist/css/bootstrap-theme.min.css">
     <link rel="stylesheet" type="text/css" href="css/lib/bootstrap.min.css">

     <style>
         body {
             font-family: Helvetica, Arial;
         }
     </style>
     <script src="js/lib/bootstrap.min.js"></script>



 -->

    <script src="js/tinymce/tinymce.min.js"></script>
    <script>
        if (uiUtils.getUrlVal('addComma') == 'true') {
            window.addCommaAfterEachSentence = true
        }

        function initStyles() {

            // return;
            /*
             background-color: #EEF8C8;
             opacity: 1;
             */

            var head = $($('iframe')[1]).contents().find("head")
            var css = '<style type="text/css">' +
                '.highlight{background-color: #EEF8C8; opacity: 1;}; ' +
                '</style>';
            $(head).append(css);
        }
        setTimeout(initStyles, 2000)

        window.handleIframes = false
        var c = {};

        function debounce(func, wait, immediate) {
            var timeout;
            return function () {
                var context = this, args = arguments;
                var later = function () {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        }
        ;

        c.speakCurrentElement = function () {
            console.log('speak current');

            var ui = $(c.element);

            var text = ui.text().trim();
            $('#txtEdit').text(text);
            $('#speakingBox').show();
            $('#speakingBox').attr('title', text);
            c.status('speking:' + text)
            console.log('speak current element');
            window.speak({text: text});
            ui.addClass('highlight')
        }

        c.status = function (c) {
            console.log('speak current');
            $('#txtConsole').text(c);
        }

        c.highlight = function highligiht() {

        }

        c.removeHighlight = function removeHighlight() {
            if (tinyMCE.get('mainContent') == null)
                return;
            var content = tinyMCE.get('mainContent').getContent();
            var b = $(tinyMCE.get('mainContent').getBody());
            var content = b.text();
            var children = b.children();
            var children = b.find('*');
            children.removeClass('highlight');
        }

        c.loadPage = function loadPage(url) {

            var cfg = {};
            cfg.url = url;
            cfg.noGet = true;
            cfg.fxDone = function onFxDone(div, body, cc) {
                var b = $(tinyMCE.get('mainContent').getBody());
                b.html(div)
                c.postPasteProcess()
                // debugger
            }
            uiUtils.utils.loadPage(cfg)
        }

        c.bodyHTML = function bodyHTML() {
            var mainContent = tinyMCE.get('mainContent')
            var body = mainContent.getBody();
            var b = $(body)
            return b.html();
        }

        function createCDom(b) {


            c.dom = {}
            c.dom.b = c.dom.body = b;


            c.doesHaveImageSrc = c.dom.doesHaveImageSrc
                = function doesHaveImageSrc(id, href) {
                var imgYahoo = b.find('#' + id);
                var href = imgYahoo.attr('src');

                if (imgYahoo.length > 0 && href &&
                    href.includes(href)) {
                    return true;
                }
                return false
            }


            c.exists = function asdf(jq) {
                return c.dom.b.find(jq).exists()
            }

            c.dom.findAnyJQWithPropValeqX = function findAnyJQWithPropValeqX(jq, prop, findVal) {
                var findUIs = b.find(jq);
                var found = null;
                $.each(findUIs, function searchFor(k, v) {
                    var img = $(v)
                    var val = img.attr(prop)
                    if (val && val.includes(findVal)) {
                        found = img;
                        return false;
                    }
                })
                if (found) {
                    return found;
                }
                return null;
            }

            c.dom.doesHaveLinkToHref = function doesHaveLinkToHref(href) {
                var y = c.dom.findAnyJQWithPropValeqX('a', 'href', href)
                return y != null;
            }


            c.dom.doesHaveImageSrc2 = function doesHaveImageSrc2(src) {
                var y = c.dom.findAnyJQWithPropValeqX('img', 'src', src)
                return y != null;
            }

            function removeUIComps(ids) {
                var args = uiUtils.convertArgumentsToArray(arguments)
                $.each(args, function ok(k, v) {
                    var ui = b.find(v)
                    ui.remove();
                })
            }

            c.dom.remove = removeUIComps;

            c.dom.hasId = function hasId(id) {
                var result = c.dom.b.find('#' + id)
                if (result.length > 0) {
                    return true;
                }
                return false;
            }
            c.dom.replaceWith = function replaceWith(id) {
                if (id.jquery) {
                    c.dom.b.html(id);
                    return;
                }

                var result = c.dom.b.find(id)
                result = $(result)
                c.dom.b.html(result.html())
                /*if ( result.length > 0 ) {
                 return true;
                 }
                 return false;*/
            }
            c.dom.ifHasThisIsMain = function ifHasThisIsMain(id, fxDone) {
                var result = c.dom.b.find(id)
                //debugger
                if (result.length == 0) {
                    return;
                }
                result = $(result)
                c.dom.b.html(result.html())

                console.log('ifHasThisIsMain', fxDone)
                sh.cid(fxDone)
                /*if ( result.length > 0 ) {
                 return true;
                 }
                 return false;*/
            }
            c.dom.ifFoundFx = function ifFoundFx(id, fxDone) {
                var result = c.dom.b.find(id)
                //debugger
                if (result.length == 0) {
                    return;
                }

                console.log('ifFoundFx', fxDone)
                sh.cid(fxDone)
            }
            c.dom.padding0 = function padding0(id) {
                var result = c.dom.b.find(id)
                result = $(result)
                result.css('padding', '0px 0px 0px 0px')
                return result
            }
            c.dom.margin0 = function margin0(id) {
                var result = c.dom.b.find(id)
                result = $(result)
                result.css('margin', '0px 0px 0px 0px')
                return result
            }
            c.dom.clearWidth = function clearWidth(id) {
                var result = c.dom.b.find(id)
                result = $(result)
                result.css('max-width', '')
                result.css('width', '')
                return result
            }
            c.dom.clearHeight = function clearHeight(id) {
                var result = c.dom.b.find(id)
                result = $(result)
                result.css('max-height', '')
                result.css('min-height', '')
                result.css('height', '')
                return result
            }
            c.dom.removeUIComps = removeUIComps;
            c.dom.doNotRead = function doNotRead(id) {
                var result = c.dom.b.find(id)
                result = $(result)
                result.addClass('doNotReadComp')
            }

            c.dom.removeTextThatSays = function removeTextThatSays(fxCall, all) {
                var arr = b.find('*').contents().filter(function () {
                    return this.nodeType === 3;
                });

                arr.add(b.find('span'))

                if (all) {
                    arr = b.find('*');
                }
                arr.each(function ok(k, v) {
                    //console.log(k,v)

                    var ui = $(v)
                    if (all) {
                        if (ui.children().length > 0) {
                            return;
                        }
                    }

                    var text = ui.text().trim()

                    var text2 = text.replace(/ +(?= )/g, '');
                    var result = fxCall(text, ui, text2)
                    if (result == true) {
                        ui.remove()
                        return;
                    }
                    //debugger;
                })
            }


            c.dom.hasLinkWithText = function hasLinkWithText(searchForTxt, dbg) {

                var hasIt = false;
                var arr = b.find('a')
                arr.each(function ok(k, v) {
                    //console.log(k,v)
                    var ui = $(v)
                    var text = ui.text().trim()
                    if (dbg)
                        console.log(text, searchForTxt)
                    if (text.length < searchForTxt.length) {
                        return;
                    }

                    if (text.includes(searchForTxt)) {
                        hasIt = true
                        return false;
                    }
                })

                return hasIt
            }

            c.dom.hasUIWithText = function hasUIWithText(searchForTxt, type, dbg) {
                var hasIt = false;
                type = sh.dv(type, '*')
                var arr = b.find(type)
                arr.each(function ok(k, v) {
                    //console.log(k,v)
                    var ui = $(v)
                    var text = ui.text().trim()

                    if (text.length < searchForTxt.length) {
                        return;
                    }
                    if (dbg)
                        console.log(k, text, searchForTxt.length, searchForTxt.includes(text)) //, sh.paren(searchForTxt) )
                    if (dbg && k == 133) {
                        //    console.log(k, text, searchForTxt.length, searchForTxt.includes(text))
                        //   debugger;
                    }

                    //
                    if (text.includes(searchForTxt)) {
                        hasIt = true
                        return false;
                    }
                })

                return hasIt
            }

            c.dom.removeTextThatSays2 = function removeTextThatSays2(removeExactText) {
                c.dom.removeTextThatSays(function clearHourse(x, ui, x2) {
                        //console.log('content', x2)
                        if (x.trim() == removeExactText) {
                            return true;
                        }
                    }
                )
            }

            c.dom.removeIfTextIncludes =
                function removeTextThatSays2(ifIncludes) {
                    c.dom.removeTextThatSays(function clearHourse(x, ui, x2) {
                            //console.log('content', x2)
                            if (x.trim().includes(ifIncludes)) {
                                return true;
                            }
                        }
                    )
                }


            c.dom.find = function findAnyComponent(cfg) {
                if (cfg.type) {
                    itemsSearch = c.dom.b.find(cfg.type)
                } else {
                    itemsSearch = c.dom.b.children()
                }
                var foundItem = null;
                $.each(itemsSearch, function addEachChild(k, v) {
                    var ui = $(v)

                    if (cfg.textIncludes) {
                        if (ui.text().includes(cfg.textIncludes) == false) {
                            //console.debug('reject', cfg.textIncludes, ui)
                            return;
                        }
                    }

                    if (cfg.clazz) {
                        if (ui.hasClass(cfg.clazz) == false) {
                            //console.debug('reject', cfg.textIncludes, ui)
                            return;
                        }
                    }

                    if (cfg.hrefIncludes) {
                        var href = ui.attr('href');
                        if (href.includes(cfg.hrefIncludes) == false) {
                            //console.debug('reject', cfg.textIncludes, ui)
                            return;
                        }
                    }
                    foundItem = ui;
                    //foundItems.push(ui)
                })

                return foundItem
            }


            c.dom.findInnerArticle = function findInnerArticle(start) {
                var mainArticle = null;
                $.each(start, function cp(k, v) {
                    var ar = $(v)
                    if (ar.text().length > 200) {
                        if (mainArticle && mainArticle.text().length > ar.text().length) {
                            return; //ignore b/c not longer
                        }
                        mainArticle = ar;
                    }
                })
                return mainArticle
            }


            $.fn.exists = function doesQueryReturnResults() {
                return this.length !== 0;
            }
            return c;
        }

        c.postPasteProcess = function postPasteProcess() {

            var mainContent = tinyMCE.get('mainContent')
            var body = mainContent.getBody();

            var b = $(body)


            $(body).find('iframe').remove();
            $(body).find('#main-navigation').remove()
            window.scrollIntoViewDivs = true
            debugger
            var d = createCDom(b);


            var imgYahoo = b.find('#uh-logo');
            if (imgYahoo.length > 0 &&
                imgYahoo.attr('href').includes('yahoo.com')) {
                //$(body).find('#modal-header').css('background', 'red')

                b.find('#mega-uh').remove();

                b.find('.modal-actions').remove();

                var viewer = b.find('#content-col')
                if (viewer.length > 0) {
                    b.html(viewer.html())
                }
                d.dom.removeUIComps('#kicker')
                d.dom.removeUIComps('.modal-closebtn')
                d.dom.removeUIComps('.canvas-share-buttons')

                console.log('yahoo')

                d.dom.replaceWith('#story-meta')
                d.dom.replaceWith('.YDC-UniCol1')
                d.dom.replaceWith('.YDC-Col1-1-Stack')

                d.dom.removeUIComps('.modalRight')
                return;
            }


            /*var arr = [
             d.dom.hasId('logocont'), d.dom.hasId('center_col')
             ]
             debugger*/
            // debugger
            if (d.dom.hasId('logocont') && d.dom.hasId('center_col')) {

                console.clear()
                console.debug('clear google')

                d.removeUIComps('#top_nav', '#sfcnt', '#appbar',
                    '#searchform', '.sfbgx', '#gac_scont')

                d.dom.replaceWith('#center_col')
                d.dom.doNotRead('#fprs')
                return;
            }

            var img = d.dom.b.find('#orb-banner').find('img[alt=BBC]')
            if (img.exists()) {

                console.clear()
                console.debug('clear bbc')

                /*
                 removeUIComps('#top_nav', '#sfcnt', '#appbar',
                 '#searchform', '.sfbgx', '#gac_scont')
                 */
                d.dom.replaceWith('.story-body')
                d.dom.doNotRead('#fprs')
                return;
            }

            var logoMedium = d.dom.b.find('.siteNav-logo');
            if (logoMedium.length > 0 && logoMedium.attr('href').includes('medium.com')) {

                console.clear()
                console.debug('clear medium')

                /*      removeUIComps('#top_nav', '#sfcnt', '#appbar',
                 '#searchform', '.sfbgx', '#gac_scont')
                 */
                d.dom.replaceWith('article')
                //section-inner sectionLayout--insetColumn
                var inset = d.dom.padding0('.section-inner.sectionLayout--insetColumn')
                inset.css('max-width', null)
                inset.css('max-width', '')
                inset.css('width', '')
                //  d.dom.doNotRead('#fprs')
                var div = d.dom.b.find('.col.u-size12of12.js-postMetaLockup')
                d.dom.clearWidth('.col.u-size12of12.js-postMetaLockup')
                d.dom.clearWidth('.u-maxWidth740')
                d.dom.removeUIComps('.js-followState')
                d.dom.removeIfTextIncludes('Clapping shows you')
                d.dom.removeIfTextIncludes('Show your support')
                d.dom.removeUIComps('.postActions', '.postPromotionWrapper')
                return;
            }


            if (d.doesHaveImageSrc('logo', 'dailymail.co.uk')) {
                //  debugger;

                var article = b.find('#js-article-text')
                b.html(article.html())

                b.find('.mol-video').remove()

                d.removeUIComps('#articleIconLinksContainer')

                d.removeUIComps(
                    '.mol-style-bold',
                    '.byline-section',
                    '.related-carousel',
                    '#most-watched-videos-wrapper',
                    '.teads-inread sm-screen', '.adHolder', '.teads-inread', '#taboola-below-main-column', '#most-read-news-wrapper')

                d.removeUIComps('#external-source-links', '#wideCommentAdvert', '.rc-header.link-ccow',
                    '.shareArticles')

                d.removeUIComps('.mobile-gallery')

                //comments
                d.removeUIComps('.gr5ox', '.reply-buttons')
                d.dom.removeTextThatSays(function clearHourse(x, ui, x2) {

                        console.log('content', x2)
                        if (x2.includes('hours ago')) {
                            return true;
                        }
                    }
                )
                return;
            }


            //window.inner = d;
            //  debugger
            if (d.dom.b.find('#pcl-logo').exists() && d.dom.b.find('#menu-bar').exists() ) {
                //  debugger;

                d.dom.removeUIComps('#menu-bar')


                //comments
                d.dom.removeUIComps('.gr5ox', '.reply-buttons')
                d.dom.removeTextThatSays(function clearHourse(x, ui, x2) {

                        // console.log('content', x2)
                        if (x2.includes('Location:')) {
                            return true;
                        }
                    }
                )

                //d.dom.removeUIComps('img')

                //b.find('.reference.external').addClass('doNotReadComp');
                d.dom.removeTextThatSays(function clearHourse(x, ui, x2) {
                    console.log('content', ui[0].type, x2)
                    if (x2 == 'Documentation:') {
                        //return true;
                        // debugger
                        ui.addClass('doNotReadComp')
                    }
                    if (x2 == 'Tutorials:') {
                        //return true;
                        ui.addClass('doNotReadComp')
                    }
                    if (x2 == 'Background') {
                        ui.addClass('doNotReadComp')
                    }
                    if (x2 == 'Interacts with:') {
                        //return true;
                        ui.addClass('doNotReadComp')
                    }
                    if (ui.is('a') && x2.includes('pointclouds.org')) {
                        ui.addClass('doNotReadComp')
                    }
                }, true)

                d.dom.removeTextThatSays(function clearHourse(x, ui, x2) {
                        console.log('content', x2)
                        if (x2 == 'Top') {
                            return true;
                        }
                    }
                )
                d.dom.removeUIComps('.docutils')
                var bl = d.dom.b.find('blockquote')
                $.each(bl, function onBl(k, v) {
                    var ui = $(v)
                    if (ui.text().includes('MAC OS')) {
                        ui.remove();
                        return
                    }
                })

                var bl = d.dom.b.find('blockquote')
                $.each(bl, function onBl(k, v) {
                    var ui = $(v)
                    if (ui.find('ul').length > 0) {
                        if (ui.text().trim() == '') {
                            ui.remove();
                        }
                        ui.addClass('doNotReadComp')
                    }

                    return;
                    //$.each(a, func)
                    if (ui.text().includes('MAC OS')) {
                        ui.remove();
                        return
                    }
                })

                return;
            }

            b.find('.js-inject-promo').remove()
            b.find('.social-kit-top').remove()
            b.find('.article-embed-share').remove()
            b.find('.social-kit-bottom').remove()
            // debugger;

            //debugger
            $(body).find('#main-header').remove()
            $(body).find('.social-tools').remove()


            if (b.find('#sr-header-area').length > 0) { //reddit?
                b.find('#sr-header-area').remove();
                b.find('.tabmenu').remove();
                b.find('.menuarea').remove()
                b.find('#header-bottom-right').remove()
                b.find('.score').remove()
                b.find('.side').remove();
                b.find('.tagline').remove();
                b.find('.domain').addClass('doNotReadComp');
                b.find('.trending-subreddits-content').remove();
                b.find('#siteTable_organic').remove();

                //jump t ocontent
                b.find('#header').remove()

                b.find('.footer-parent').remove()

                d.dom.padding0('.content')
                d.dom.margin0('.content')

                b.find('.flat-list.buttons').remove()
                b.find('.infobar').remove()

                b.find('.panestack-title').remove() //all x comments
//listingsignupbar

                b.find('.seo-comments').remove() //MORE COMMENTS
                b.find('.seo-comments-recommendations').remove() //recommendations

                b.find('a').each(function ok(k, v) {
                    //console.log(k,v)
                    var ui = $(v)
                    var text = ui.text().trim()
                    if (ui.text() == 'share') {
                        ui.remove()
                    }
                    if (ui.text() == 'report') {
                        ui.remove()
                    }


                    if (ui.text().includes('comments')) {
                        //href item?id=
                        ui.addClass('doNotReadComp')
                    }
                    //debugger;
                })
            }
            c.speakSettings = {};
            c.speakSettings.doNotDing = false;
            if (b.find('#hnmain').length > 0) {
                c.speakSettings.doNotDing = true;
                b.find('span.pagetop').remove();
                b.find('.pocket-hn-botton').remove();
                b.find('.pocket-hn-button').remove()
                b.find('.pocket-hn-button').remove()
                b.find('.score').remove()
                b.find('.age').remove();
                b.find('.hnuser').remove();
                b.find('a').each(function ok(k, v) {
                    //console.log(k,v)
                    var ui = $(v)
                    if (ui.text() == 'hide') {
                        ui.remove()
                    }

                    if (ui.text().includes('comments')) {
                        //href item?id=
                        ui.addClass('doNotReadComp')
                    }
                    if (ui.text().includes('comment')) {
                        //href item?id=
                        ui.addClass('doNotReadComp')
                    }
                    //debugger;
                })

                b.find('.sitestr').each(function addFromToSource(k, v) {
                    //console.log(k,v)
                    var ui = $(v)

                    ui.text('  from ' + ui.text() + ' .')
                    d.dom.doNotRead(ui)
                    //debugger;
                })


                //debugger
                var arr = b.find('*').contents().filter(function () {
                    return this.nodeType === 3;
                });
                arr
                    .each(
                        function removeByAndBrokenBar(k, v) {

                            if (v.wholeText.includes('|') ||
                                v.wholeText.trim() == '|') {
                                // debugger;
                                v.data = ' ';
                                v.text = ' '
                                v.nodeValue = ' ';
                                // v.remove();
                            }
                            if (v.wholeText.trim() == 'by') {
                                v.remove();
                            }

                            console.log(v)
                            //debugger
                        })

                d.dom.removeTextThatSays2('discuss')
                c.readBrokenBar = false;
                return;
            }


            // debugger
            if (b.find('img[alt="The New York Times"]').exists()
                || b.find('image[alt="The New York Times"]').exists()) {

                console.debug('is new york times')

                b.find('#masthead').remove()
                b.find('#ribbon').remove()

                var article = b.find('article')
                article = $(article)
                b.html(article.html())

                b.find('.newsletter-signup').remove()
                b.find('.story-meta-footer-sharetools').remove()
                b.find('#newsletter-promo').remove()
                b.find('.story-translations').remove()
                b.find('.visually-hidden').remove()
                b.find('.skip-to-text-link').remove()
                b.find('.story-interrupter').remove()
                b.find('.story-translations').remove()
                b.find('.story-info').remove()
                b.find('.story-print-citation').remove()
                b.find('.supplemental').remove();
                b.find('.story-body').css('width', '') //remove();
                b.find('p').each(function removeStyling(k, v) {
                    //console.log(k,v)
                    var ui = $(v)
                    ui.css('width', '')
                    ui.css('font-family', 'helvetica')
                })

                b.find('.sitestr').each(function addFromToSource(k, v) {
                    //console.log(k,v)
                    var ui = $(v)

                    ui.text('. from ' + ui.text() + ' .')
                    d.dom.doNotRead(ui)
                    //debugger;
                })


                var arr = b.find('*').contents().filter(function () {
                    return this.nodeType === 3;
                });
                arr
                    .each(
                        function removeByAndBrokenBar(k, v) {

                            if (v.wholeText.includes('|') ||
                                v.wholeText.trim() == '|') {
                                // debugger;
                                v.data = ' ';
                                v.text = ' '
                                v.nodeValue = ' ';
                                // v.remove();
                            }
                            if (v.wholeText.trim() == 'by') {
                                v.remove();
                            }

                            console.log(v)
                            //debugger
                        })


                c.readBrokenBar = false;
            }

            if (b.find('div.content').length > 0 && b.find('.article-text-wrap').length > 0) {
                //debugger;
                d.dom.replaceWith('div.content')
                d.dom.padding0('.article-text-wrap')
            }


            var isSMF = d.dom.doesHaveImageSrc2('smflogo.gif')
                && d.dom.doesHaveLinkToHref('http://www.simplemachines.org/about/copyright.php')

            if (isSMF) { //d.dom.hasLinkWithText('Powered by SMF')) {
                // debugger;
                console.log('is SMF')
                d.dom.removeUIComps('.tborder', '.signature')
                d.dom.doNotRead('.poster_info')
                d.dom.doNotRead('.subject')
                d.dom.doNotRead('.smalltext')

                d.dom.doNotRead('.nav') //will have to undo these
                d.dom.doNotRead('td.middletext') //top left numbers
                d.dom.doNotRead('.mirrortab_back')

                // debugger
                var tr = d.dom.b.find('tr')
                $.each(tr, function removeAddRow(k, v) {
                    var tr = $(v)
                    var text = tr.text();
                    var spans = tr.find('span')
                    removeAdRow = false;
                    $.each(spans, function removeAddSpan(k, v) {
                        var tr = $(v)
                        // console.log('log text', tr.text() )
                        // var spans = tr.children('span')
                        var classList = tr.attr('class')
                        classList = sh.dv(classList, '')
                        classList = classList.split(/\s+/);
                        //console.log('\t', '\t', classList )
                        $.each(classList, function (index, className) {
                            if (className.endsWith('-ad')) {
                                removeAdRow = true;
                                return false;
                            }
                        });

                    })

                    if (removeAdRow) {
                        tr.remove()
                    }
                })
                d.dom.removeUIComps('td.smalltext')
                var td = d.dom.b.find('td.smalltext')
                // debugger;
                d.dom.doNotRead('.quote')
                d.dom.doNotRead('.quoteheader')
                //d.dom.b.find('#dgp-ad-wrapper').parents('td').remove()
                d.dom.b.find('#dgp-ad-wrapper').remove()
                d.dom.b.find('.maintab_first').parent().parent().remove()

                //d.dom.findByText('previous topic').parents('table').remove();
                return;
            }


            var isPHPBB = d.dom.hasUIWithText('Forum Software © phpBB Limited', 'div', false)
                && d.dom.doesHaveLinkToHref('https://www.phpbb.com/')
            // debugger;
            if (isPHPBB) { //d.dom.hasLinkWithText('Powered by SMF')) {
                //  debugger;
                console.log('is bt sytem')
                d.dom.removeUIComps('#page-header', '#nav-breadcrumbs',
                    '#viewtopic', 'c.postprofile.resized', '.action-bar')
                //   d.dom.removeUIComps('.has-profile', '.signature')
                d.dom.removeUIComps('.post-buttons')
                d.dom.removeUIComps('.codebox_plus_about')
                d.dom.removeUIComps('.profile-posts')
                d.dom.removeUIComps('.profile-joined')
                var hasProfile = d.dom.b.find('.has-profile')
                console.log(hasProfile)
                d.dom.padding0('.inner')
                // d.dom.removeUIComps('.post_buttons')
                d.dom.clearHeight('.postprofile')
                //d.dom.removeUIComps('.inner')
                d.dom.doNotRead('.poster_info')
                d.dom.doNotRead('.subject')
                d.dom.doNotRead('.smalltext')
                d.dom.removeUIComps('td.smalltext')
                var td = d.dom.b.find('td.smalltext')
                // debugger;
                d.dom.doNotRead('.quote')
                d.dom.doNotRead('.quoteheader')
                //d.dom.b.find('#dgp-ad-wrapper').parents('td').remove()
                d.dom.b.find('#dgp-ad-wrapper').remove()
                d.dom.b.find('.maintab_first').parent().parent().remove()

                //d.dom.findByText('previous topic').parents('table').remove();
                return;
            }


            function checkQuora() {
                var isQuora1 = d.dom.find({type: 'a', textIncludes: 'Home', clazz: 'nav_item_link'})
                var isQuora2 = d.dom.find({type: 'a', textIncludes: 'Add Question', clazz: 'AskQuestionButton'})
                var isQuora3 = d.dom.find({type: 'zz', textIncludes: 'Home', clazz: 'nav_item_link'})
                //LookupBarAskQuestionModalButton AskQuestionButton
              //debugger
                if (isQuora1 && isQuora2) {
                    //debugger
                    d.dom.remove('.SiteHeader', '.layout_2col_side')
                    d.dom.remove('.ActionBar', '.answer_auto_expanded_comments')
                    d.dom.remove('.upper_content')
                    d.dom.remove('.OriginallyAnsweredBanner')


                    d.dom.remove('.ContentPageFeed')


                    // d.dom.doNotRead('AnswerFooter');
                    d.dom.remove('.CredibilityFacts')
                    d.dom.remove('.TopicListItems2')


                    d.dom.replaceWith('.layout_2col_main')
                    //TopicListItems2 Toggle SimpleToggle QuestionTopicListItems QuestionTopicHorizontalListItems
                }
                return;
            }
            checkQuora();
d
            function checkGitHubSrc() {
                var isFileNav = c.dom.find('.file-navigation');
                var isCommit = c.dom.find('.commit-tease');
                if (isFileNav && isCommit) {
                   // debugger

                    d.dom.replaceWith('.blob-wrapper')
                    lines = c.dom.find('.js-file-line-container').find('tr')
                    $.each(lines, function asdf(k,ui) {
                        var line = $(ui)
                        var content = line.find('.blob-code-inner');
                        var text = content.text();
                        text = text.trim();
                        //debugger
                        if ( text.startsWith('#')==false){
                            d.dom.doNotRead(line)
                        }
                    })
                    //TopicListItems2 Toggle SimpleToggle QuestionTopicListItems QuestionTopicHorizontalListItems
                }
                return;
            }
            checkGitHubSrc();

            var isGuardian = c.dom.find('.inline-guardian-logo-160');
            if (isGuardian) {
                //debugger
                d.dom.remove('.content__secondary-column')
                d.dom.remove('aside')
                d.dom.remove('.submeta__share')
                d.dom.remove('.contributions__epic')
                d.dom.remove('.social.social--top.js-social--top')
                d.dom.clearWidth('.content__main-column');
                d.dom.margin0('.content__main-column');
                d.dom.clearWidth('.content__meta-container');
                d.dom.margin0('.content__meta-container');
                d.dom.b.find('.content__meta-container').css('position', 'relative');
            }

            //debugger
            function lookForMainArticle() {
                var article = b.find('article')
                var mainArticle = null;
                $.each(article, function cp(k, v) {
                    var ar = $(v)
                    if (ar.text().length > 200) {
                        if (mainArticle && mainArticle.text().length > ar.text().length) {
                            return; //ignore b/c not longer
                        }
                        mainArticle = ar;
                    }
                })

                if (mainArticle) {
                    var innerArticles = mainArticle.find('article')
                    if (innerArticles.length > 1) {
                        mainArticle = d.dom.findInnerArticle(innerArticles)
                        //debugger
                    }
                }

                if (mainArticle) {
                    console.log('generic article')
                    var text = mainArticle.text();
                    var comments = b.find('entry_comments')
                    // debugger;
                    d.dom.replaceWith(mainArticle)

                    //rolling stone
                    d.dom.clearWidth('.content-rail').css('width', '');
                    d.dom.clearWidth('.center-rail').css('width', '');
                    d.dom.clearWidth('.content-head').css('width', '');
                    d.dom.removeUIComps('#module-more-news', '.content-foot', '.right-rail')
                    d.dom.removeUIComps('.module-social-sharing', '.module-related')
                    d.dom.removeUIComps('.related_post_title', '.related_post', '.ssba', '.ssba-wrapper')
                    //npr
                    d.dom.removeUIComps('.story-tools')
                    d.dom.removeUIComps('.tags', '.contributor-byline', '.contributed')
                    d.dom.removeUIComps('.next-story-link')
                    d.dom.removeUIComps('.newsletters-signup')
                    //d.dom.ifHasThisIsMain('.1-main-container', function onTechCrunch()  {


                    //})
                    d.dom.ifFoundFx('.l-main-container', function onTechCrunch() {
                        // debugger
                        d.dom.clearWidth('.article-entry').css('width', '')
                        d.dom.clearWidth('.l-main-container').css('width', '')
                        d.dom.clearWidth('.article')
                    })

                    return;
                }


            }

            lookForMainArticle();

            function amazonArticle() {
                if (c.dom.doesHaveLinkToHref('www.amazon.com/ref=nav_logo') == false) {
                    return;
                }

                d.dom.removeUIComps('#nav-upnav', 'header')
                d.dom.removeUIComps('#navFooter', 'center')
                d.dom.removeUIComps('#sendSampleBox', 'center')
                return
                //asdf.g
                var article = b.find('article')
                var mainArticle = null;
                $.each(article, function cp(k, v) {
                    var ar = $(v)
                    if (ar.text().length > 200) {
                        if (mainArticle && mainArticle.text().length > ar.text().length) {
                            return; //ignore b/c not longer
                        }
                        mainArticle = ar;
                    }
                })

                if (mainArticle) {
                    var innerArticles = mainArticle.find('article')
                    if (innerArticles.length > 1) {
                        mainArticle = d.dom.findInnerArticle(innerArticles)
                        //debugger
                    }
                }

                if (mainArticle) {
                    console.log('generic article')
                    var text = mainArticle.text();
                    var comments = b.find('entry_comments')
                    // debugger;
                    d.dom.replaceWith(mainArticle)

                    //rolling stone
                    d.dom.clearWidth('.content-rail').css('width', '');
                    d.dom.clearWidth('.center-rail').css('width', '');
                    d.dom.clearWidth('.content-head').css('width', '');
                    d.dom.removeUIComps('#module-more-news', '.content-foot', '.right-rail')
                    d.dom.removeUIComps('.module-social-sharing', '.module-related')
                    d.dom.removeUIComps('.related_post_title', '.related_post', '.ssba', '.ssba-wrapper')
                    //npr
                    d.dom.removeUIComps('.story-tools')
                    d.dom.removeUIComps('.tags', '.contributor-byline', '.contributed')
                    d.dom.removeUIComps('.next-story-link')
                    d.dom.removeUIComps('.newsletters-signup')
                    //d.dom.ifHasThisIsMain('.1-main-container', function onTechCrunch()  {


                    //})
                    d.dom.ifFoundFx('.l-main-container', function onTechCrunch() {
                        // debugger
                        d.dom.clearWidth('.article-entry').css('width', '')
                        d.dom.clearWidth('.l-main-container').css('width', '')
                        d.dom.clearWidth('.article')
                    })

                    return;
                }
            }

            amazonArticle();

            if (b.find('.l-article-body-segment').exists()) {
                d.dom.replaceWith('.l-article-body-segment')
            }

            if (b.find('#content').exists()) {
                var comments = b.find('entry_comments')
                d.dom.replaceWith('#content')
                d.dom.removeUIComps('div.sidebar')
                //d.dom.removeUIComps('.related_post_title', '.related_post', '.ssba', '.ssba-wrapper')
                return;
            }

            function roboDK() {
                if (false == d.dom.doesHaveImageSrc2('https://robodk.com/doc/en/style2/weblogo.svg')) {
                    return
                }
                b.find('#top').remove();
                b.find('#side-nav').remove();
                d.dom.replaceWith('#doc-content')
                d.dom.padding0('.header')
                d.dom.margin0('.header')
                d.dom.clearWidth('.header')
                d.dom.padding0('.contents')
                d.dom.margin0('.contents')
                d.dom.clearWidth('.contents')

            }

            roboDK()

            //debugger

            function github() {

                if (false == d.exists('.header-logo-invertocat') ) {
                    return
                }
                if (false == d.exists('.repository-content') ) {
                    return
                }
               // debugger
                d.dom.replaceWith('.repository-content')
                d.dom.doNotRead('.gh-header-actions')
            }

            github()

        }


        tinymce.init({
            selector: 'textarea',
            height: 500,
            theme: 'modern',
            /*plugins: "spellchecker",
             menubar: "tools",
             toolbar: "spellchecker",*/
            setup: function onSetupEditor(editor) {
                editor.on('change', function (e) {
                    console.log('change event', e);
                });
                editor.on('undo', function (e) {
                    console.log('undo event', e);
                });

                var play2 = debounce(c.speakCurrentElement, 500);
                editor.on('keydown', function (e) {
                    console.debug('Key down event: ' + e.keyCode);
                    //  var content = tinyMCE.get('mainContent').getContent();
                    // Cookies.set('prevContent', content);
                    if (e.ctrlKey) {
                        console.debug('ctrlOnly')
                        c.ctrlOnly = true;
                    } else {
                        c.ctrlOnly = false
                    }
                })
                /*  editor.on('paste', function onPaste(e) {
                 debugger
                 })*/
                editor.on('keyup', function (e) {
                    console.debug('Key up event: ' + e.keyCode);
                    var content = tinyMCE.get('mainContent').getContent();
                    Cookies.set('prevContent', content);


                    if (e.keyCode == 86 && e.ctrlKey) {
                        console.debug('paste')
                        c.pasted = true;


                        if (window.location.toString().includes('save=true')) {
                            //true saving the page ....
                            //debugger;
                            var data = {};
                            data.content = c.bodyHTML();
                            data.path = 'testArticles'
                            uiUtils.postUrl('writeArticle', data,
                                function fxDone() {
                                    console.log('saved')
                                })
                        }

                        c.postPasteProcess()
                        setTimeout(function playAllSenctencesLater() {
                            tHelper.playAllSentences();
                        }, 300)
                        return;
                    }

                    console.debug(e.keyCode, e.ctrlKey)
                    return

                    play2()
                });

                editor.on('dblclick', function (e) {
                    console.debug('dblclick: ' + e.keyCode);
                    c.status('doubleclick')
                    helper.playAllSentences();
                });


                editor.on('nodeChangeX', function (e) {
                    console.log('node event', e.element);
                    if (c.element == e.element) {
                        return
                    }
                    c.element = e.element
                    var ui = $(e.element);

                    // var ui = $(c.element)
                    // var text = ui.text()
                    // debugger;
                    // console.debug(text, content.split(text)[1]);
                    // var final = text  + content.split(text)[1];
                    console.debug('txt to speac', text);

                    if (c.readBrokenBar) {
                        debugger
                        text = text.split('|').join('')
                    }

                    window.speak(text)
                    // play2()
                })

                editor.on('nodeChange', function onNodeChanged(e, wait) {
                    if (wait != false) {
                        setTimeout(function waitFewSecs() {
                            onNodeChanged(e, false)
                        }, 100)
                        return;
                    }
                    if (c.inited !== true) {
                        return;
                    }
                    if (c.ctrlOnly === true) {
                        return; //not useful
                    }
                    if (e.element) {
                        if (e.element.id == 'tinymce' && e.element.nodeName == 'body') {
                            return;
                        }
                    }
                    console.log('node event', e.element, c.pasted);
                    if (c.pasted == true) {
                        c.pasted = false;
                        return;
                    }
                    if (c.element == e.element) {
                        return
                    }

                    c.element = e.element
                    var ui = $(e.element);


                    $('#txtEdit').text(ui.text())
                    c.removeHighlight()
                    window.speak({text: ui.text()})
                    ui.addClass('highlight')
                });


                if (uiUtils.getUrlVal('loadLastSavedArticle') == 'true') {
                    uiUtils.getUrl('testArticles/lastSavedArticle.txt', function on(data) {
                        // debugger
                        if (c.windowLoadedArticle == true) {
                            return;
                        }
                        c.windowLoadedArticle = true
                        c.loadPage('testArticles/' + data)
                    })

                }

                if (uiUtils.getUrlVal('loadRecent') == 'true') {
                    // debugger
                    //c.loadPage('testArticles/0.7704380748327821.html')
                    // c.loadPage('testArticles/0.9368877713568509.html')
                    //c.loadPage('testArticles/0.020375478779897094.html')
                    //c.loadPage('testArticles/0.6278695156797767.html')
                    // c.loadPage('testArticles/hn-listing.html')
                    var url = 'medium.html'
                    url = 'btctalk.html'
                    url = 'nyt2.html'
                    c.loadPage('testArticles/' + url)
                }

                setTimeout(function setFocus() {
                    tinyMCE.get('mainContent').focus();
                }, 100)
                setTimeout(function setFocus() {
                    c.inited = true;
                }, 1500)


            }
        })
        ;


        function reverse() {
            var val = Cookies.get('prevContent');
            console.log('set to ', val)
            tinyMCE.get('mainContent').setContent(val)
        }


        var tHelper = {};
        window.tHelper = tHelper;

        tHelper.setupPaste = function setupPaste() {
            $("body").on("change keyup paste", tHelper.pasteHandle)
        }

        tHelper.pasteHandle = function pasteHandle(event, txt) {

            console.log('pasted')

            if (txt == null) {
                var currentVal = $(this).val();

            } else {
                currentVal = txt;
            }
            var txtOrig = currentVal;

            //fix issues with text
            currentVal = currentVal.replace(//gm, "");
            currentVal = currentVal.replace(/’/gm, "'");

            if (currentVal == oldVal) {
                return; //check to prevent multiple simultaneous triggers
            }
        };

        tHelper.playAllSentences = function readText() {
            window.skipJrlTitles = true;
            var tiny = tinyMCE.get('mainContent');
            var content = tinyMCE.get('mainContent').getContent();
            var b = $(tinyMCE.get('mainContent').getBody());
            var b2 = $(b)
            b2.find('.highlight').removeClass('highlight')
            var content = b.text();
            var children = b.children();
            var foundElement = false;

            var text = '';

            var toDiv = $($('iframe')[1]).contents().find('body')
            window.sentenceHelper.setupSentences(toDiv, toDiv);

            console.debug('dblclick: ', children, toDiv);
            debugger
            if (c.speakSettings) {
                $.each(c.speakSettings, function copyTo(k, v) {
                    window.sentenceHelper.settings[k] = v
                });
            }
            window.speak('paste command')
            window.speak('paste')
            setTimeout(function call() {
                console.debug('go play all ..')
                window.sentenceHelper.onPlay2UI()
                return;
                setTimeout(function call() {
                    console.debug('go play all ..')
                    window.sentenceHelper.onPlay2UI()
                }, 200)
            }, 700)

            return;
            $.each(children, function addEachChild(k, v) {
                var ui = $(v)
                var p = $(c.element).parent()[0]
                console.log(v, ui, p)
                if (v == c.element)
                    foundElement = true
                if (v == p)
                    foundElement = true
                if (foundElement)
                    text += ui.text().trim() + ' ';
            })

            // var ui = $(c.element)
            // var text = ui.text()
            // debugger;
            // console.debug(text, content.split(text)[1]);
            // var final = text  + content.split(text)[1];
            console.debug('txt to speac', text);
            window.speak(text)
            // play2()
        };


        //   debugger
        tHelper.setupPaste()

        tHelper.setupControlBox = function setup() {
            //utils.addCheckbox('Speak On Paste')
            //utils.ignoreAddLinkThings('Speak On Paste')
        }
        tHelper.setupControlBox();


    </script>

    <style>

        .highlight {
            background-color: #00b68f;
            opacity: 0.3;

            background-color: #EEF8C8;
            opacity: 1;

        }

        .highlight2 {
            background-color: #C6E746;
            opacity: 0.3;
        }

    </style>
</head>
<body>

<!--<div class="highlight highlight2" >sdffffffffff
dfg
dfg
</div>-->
<!-- initially hidden right-click menu -->
<div class="hideContextMenu" id="rmenu">
    <ul>
        <li>
            <a onclick="contextMenuHelper.copy()">Copy</a>
        </li>
    </ul>
</div>

<!--
$($('iframe')[1]).contents().find("head")
var head = jQuery("#frame1").contents().find("head");
var css = '<style type="text/css">' +
'.container{background:blue}; ' +
'</style>';
jQuery(head).append(css);
});
-->

<div class="hideContextMenu" id="contextAddBookmark">
    <div id="contextAddBookmark_lbl"></div>

    <textarea id="contextAddBookmark_txt"
              placeholder="important b/c ... inspires me to ..."
              style="height: 200px; width: 150px; border: solid 1px white;"></textarea>

    <br/>
    <button id="btnAddNote">Add Notes</button>
    <button id="btnContextMenuClose">Close</button>
    <br/>
    <br/>
    <div id="btnBar">
        <button id="btnQuote">Quote</button>
        <button>Cool</button>
        <br/>
        <button id="btnTryThis">TODO</button>
        <br/>
        <button id="btnEpiphany">Epi</button>
        <button id="btnPainful">Pain</button>
    </div>

    <span id="contextSentiments"></span>
    <br/>
    <div id="txtAreaforBookMark" style="max-height: 100px; max-width: 150px; overflow: auto;">sdfsdf</div>

</div>


<textarea id="mainContent">
</textarea>


<br/>
<div id="txtEdit">

</div>
<span id="speakingBox">speaking</span>
<div id="txtConsole">sttaus</div>
<button onclick="reverse()">reverse</button>
<button onclick="  tHelper.playAllSentences()">playall</button>
|
<button onclick="window.loadRecent=!window.loadRecent; uiUtils.setUrlVal('loadRecent', window.loadRecent)">loadRecent
</button>

<button onclick="window.autoSave=!window.autoSave; uiUtils.setUrlVal('save', window.autoSave)">autoSave</button>

<button onclick="window.loadLastSavedArticle=!window.loadLastSavedArticle; uiUtils.setUrlVal('loadLastSavedArticle', window.loadLastSavedArticle)">
    loadLastSavedArticle
</button>

<div id="controlBox"></div>


<script type="text/javascript" src="http://127.0.0.1:10110/jquery.js"></script>
<!--
<script type="text/javascript" src="http://127.0.0.1:10110/ui_utils.js"></script>
-->
<script type="text/javascript" src="http://127.0.0.1:10110/g/js/reloaderGH.js"></script>


<script>
    function onReloader() {
        reloader.reloadWhenSelf();
        reloader.reloadWhen('ui_utils.js');
        reloader.filter = '/TTS-Reader/';
        reloader.reloadWhenFx('drawPB.js', function onTestOneJs(a, b, c) {
        })
        reloader.loadFromOrig = true;
        //C:/Users/user1/Dropbox/projects/ritv2/videoproject/Code/code-yeti/test3/testFramework.js
        reloader.addReloadMapping('C:/Users/user1/Dropbox/projects/ritv2/videoproject/Code/code-yeti/', '')
        //reloader
    }
    window.onReloader = onReloader;
    window.setupReloader = onReloader
</script>

</body>


</html>
